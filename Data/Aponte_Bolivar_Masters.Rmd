---
title: "Aponte_Bolivar_Masters"
author: "Bolívar Aponte Rolón"
date: "Last edited: `r format(Sys.time(), '%B %d, %Y')`"
output: html_document
toc: true
toc_depth: 2
number_sections: true
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# WD
```{r, Start up}
rm(list = ls())
setwd("C:/Users/boloq/Box/Thesis/Proyecto_2/Data")
set.seed(123)
```

# Old 2016 functions and code
I have replaced a lot of this code with `tidyverse` syntax. These are functions and loops that i used for my masters thesis version in 2018. The 2022 version is, might I say, `tidyr`.
```{r, Old things}
#Function to generate formatted R2 data from a linear regression model
# 
# lm_eqn <- function(df){
#   m <- lm(y ~ x, df);
#   eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
#                    list(a = format(coef(m)[1], digits = 2), 
#                         b = format(coef(m)[2], digits = 2), 
#                         r2 = format(summary(m)$r.squared, digits = 3)))
#   as.character(as.expression(eq));                 
# }
# 
# 
# 
# #Multiplot function
# multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
#   library(grid)
#   
#   # Make a list from the ... arguments and plotlist
#   plots <- c(list(...), plotlist)
#   
#   numPlots = length(plots)
#   
#   # If layout is NULL, then use 'cols' to determine layout
#   if (is.null(layout)) {
#     # Make the panel
#     # ncol: Number of columns of plots
#     # nrow: Number of rows needed, calculated from # of cols
#     layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
#                      ncol = cols, nrow = ceiling(numPlots/cols))
#   }
#   
#   if (numPlots==1) {
#     print(plots[[1]])
#     
#   } else {
#     # Set up the page
#     grid.newpage()
#     pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
#     
#     # Make each plot, in the correct location
#     for (i in 1:numPlots) {
#       # Get the i,j matrix positions of the regions that contain this subplot
#       matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
#       
#       print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
#                                       layout.pos.col = matchidx$col))
#     }
#   }
# }

```

# Packages needed (install)
```{r, Packages}
library("lme4")
library("nlme")
library("MuMIn")
library("vegan")
library("reshape2")###used for melting and dcast --- long vs. wide format
library("Rmisc")
library("dplyr")
library("lsmeans")
library("car")
library("corrplot")
library("ggplot2")
library("ggrepel")
library("ggfortify")
library("ggraph")
library("ggpubr")
library("ggeffects")
library("data.table")
library("devtools")
library("tidyr")
library("ggthemes")
library("sjPlot")
library("gridExtra")
library("MetBrewer")
library("BiodiversityR")
library("buildmer")
library("parameters")
#install.packages("RefManagerR")
```


# Data: Tidy version 2022

Cleaning data using `dplyr` data cleaning 10/19/2022.

```{r, Raw data}
# Computing means for mini-winkler litter depth, pH, and total leaf litter depth. 
prueba <- read.csv("Leaf_litter_data_ANTS_BAAR.csv", stringsAsFactors = TRUE, header = TRUE)
litterdf <- prueba %>%
  rowwise()%>%
  mutate(A = mean(c_across(3:6)), 
         B = mean(c_across(7:10)),  
         C = mean(c_across(11:14)), 
         Promedio.Profundidad_de_hojarasca_TOTAL = mean(c_across(15:23)),
         pH = mean(c_across(24:26))) %>%
  select(!c(2:26)) %>%
  rename(ID = Placa)
  
prlong <- litterdf %>%
  pivot_longer(-c(ID, Promedio.Profundidad_de_hojarasca_TOTAL, pH), names_to = "Replicate", values_to = "Promedio_Profundidad_Mini_Winklers_TOTAL")

prlong$ID <- as.factor(prlong$ID)

# Main data set
data <- read.csv("Data_ID_ANTS_BAAR_1292022.csv",stringsAsFactors = TRUE, header = T)

data$ID <- as.factor(data$ID)

# Join to make "new" main data set.
jdata <- left_join(prlong, data, by = c("ID" = "ID", "Replicate" = "Replicate"))

jdata <- jdata %>%
  relocate(Treatment, Record, .before = ID) %>%
  relocate(Promedio_Profundidad_Mini_Winklers_TOTAL, Promedio.Profundidad_de_hojarasca_TOTAL, pH, .after = Plantas_de_cafe) %>%
  relocate(Replicate, .after = Sampling.date)
  
#Raw data unscaled without outliers
data <- jdata %>%
  as_tibble() %>%
  filter(!(ID == "2098" | ID == "4358")) %>%
  mutate(Humidity = ((HumedadInicio-HumedadFinal)/HumedadFinal)*100, Precipitation = (AvgRainFall * 2.54)) %>%
  relocate(Humidity, .after = pH) %>%
  relocate(Precipitation, .after = Humidity) %>%
  rename(Avg_Nitrogen_per_cent = Nitrogen_per_cent,
         Avg_Carbon_per_cent = Carbon_per_cent,
         Sampling_date = Sampling.date,
         DBH = GBH_cm,
         Altitude = Altitud_m,
         Cardinality = Pendiente,
         Dist_to_edge = Distancia_de_borde_m,
         Coffee_plants = Plantas_de_cafe,
         Litter_depth = Promedio.Profundidad_de_hojarasca_TOTAL,
         Quadrat_litter_depth = Promedio_Profundidad_Mini_Winklers_TOTAL,
         Crown_Cover = Por_Ciento_Dosel,
         CN = CN.fraction,
         "%_Nitrogen" = Nitrogen_per_cent,
         "%_Carbon" = Carbon_per_cent) %>%
  select(!c(2, 5, 16, 17, 19)) %>%
  na.omit() %>%
  na.fail()

#Raw data cleaned and scaled. Eliminate outliers with 2000+ ants and its corresponding pair. 
datascl <- data %>%
  mutate_at(c(4:17), scale) %>%
  na.omit() %>% 
  na.fail()

#Summarized data unscaled
#tree_data is averaged by tree site. Meaning A, B, and C quadrats are averaged. 
tree_data <- data %>%
  as_tibble() %>%
  group_by(Treatment,ID, Sampling_date) %>%
  summarise(across(c(1:17, 19), mean),
            across(c(18, 20, 21:86), sum)) %>%
  ungroup() %>%
  na.omit() %>% 
  na.fail()

#Summarized data scaled
tree_datascl <- tree_data %>%
  mutate_at(c(4:17), scale)

#Scaling environmental variables since they are not in the same scale. 

#GBH was transformed into DBH in Excel by multiplying by pi = 3.14
##From on data will be analyzed without outliers A. latifolia with more than
## 2000 ants and its corresponding Inga pair.
##############################################################################

#Mean and standard error for Table 1 in manuscript
mean_tree <- data %>%
  group_by(Treatment) %>%
  summarise(across(c(4:18), funs(mean, se=sd(.)/sqrt(n())))) %>%
  data.table::transpose(keep.names = "Site characteristics") %>%
  as_tibble()

#`mean_tree` data frame has the information for Table 1 in manuscript.

```

## Looking at the distribution of the data.
Needs update with new syntax. 10/24/2022 BAR

```{r, qqPlots}
# 
# qqnorm(rnorm(n = length(tree_data$CN.fraction), mean =mean(tree_data$CN.fraction), sd = sd(tree_data$CN.fraction)))
# qqPlot(rnorm(n = length(tree_data$CN.fraction), mean =mean(tree_data$CN.fraction), sd = sd(tree_data$CN.fraction)))
# shapiro.test(rnorm(n = length(tree_data$CN.fraction), mean =mean(tree_data$CN.fraction), sd = sd(tree_data$CN.fraction)))
# shapiro.test(tree_data$CN.fraction)
# hist(tree_data$Abundance)
# qqnorm(rnorm(n = length(tree_data$Abundance), mean =mean(tree_data$Abundance), sd = sd(tree_data$Abundance)))
# qqPlot(rnorm(n = length(tree_data$Abundance), mean =mean(tree_data$Abundance), sd = sd(tree_data$Abundance)))
# shapiro.test(rnorm(n = length(tree_data$Abundance), mean =mean(tree_data$Abundance), sd = sd(tree_data$Abundance)))
# 
# hist(tree_data$Richness_total_abc)
# qqnorm(rnorm(n = length(tree_data$Richness_total_abc), mean =mean(tree_data$Richness_total_abc), sd = sd(tree_data$Richness_total_abc)))
# qqPlot(rnorm(n = length(tree_data$Richness_total_abc), mean =mean(tree_data$Richness_total_abc), sd = sd(tree_data$Richness_total_abc)))
# shapiro.test(rnorm(n = length(tree_data$Richness_total_abc), mean =mean(tree_data$Richness_total_abc), sd = sd(tree_data$Richness_total_abc)))
# 
# qqnorm(rnorm(n = length(tree_data$`Distance to edge (m)`), mean =mean(tree_data$`Distance to edge (m)`), sd = sd(tree_data$`Distance to edge (m)`)))
# qqPlot(rnorm(n = length(tree_data$`Distance to edge (m)`), mean =mean(tree_data$`Distance to edge (m)`), sd = sd(tree_data$`Distance to edge (m)`)))
# shapiro.test(rnorm(n = length(tree_data$`Distance to edge (m)`), mean =mean(tree_data$`Distance to edge (m)`), sd = sd(tree_data$`Distance to edge (m)`)))
# 
# qqnorm(rnorm(n = length(tree_data$`GBH (cm)`), mean =mean(tree_data$`GBH (cm)`), sd = sd(tree_data$`GBH (cm)`)))
# qqPlot(rnorm(n = length(tree_data$`GBH (cm)`), mean =mean(tree_data$`GBH (cm)`), sd = sd(tree_data$`GBH (cm)`)))
# shapiro.test(rnorm(n = length(tree_data$`GBH (cm)`), mean =mean(tree_data$`GBH (cm)`), sd = sd(tree_data$`GBH (cm)`)))
# 
# qqnorm(rnorm(n = length(tree_data$pH), mean =mean(tree_data$pH), sd = sd(tree_data$pH)))
# qqPlot(rnorm(n = length(tree_data$pH), mean =mean(tree_data$pH), sd = sd(tree_data$pH)))
# shapiro.test(rnorm(n = length(tree_data$pH), mean =mean(tree_data$pH), sd = sd(tree_data$pH)))
# 
# 
# qqnorm(rnorm(n = length(tree_data$`Altitude (m)`), mean =mean(tree_data$`Altitude (m)`), sd = sd(tree_data$`Altitude (m)`)))
# qqPlot(rnorm(n = length(tree_data$`Altitude (m)`), mean =mean(tree_data$`Altitude (m)`), sd = sd(tree_data$`Altitude (m)`)))
# shapiro.test(rnorm(n = length(tree_data$`Altitude (m)`), mean =mean(tree_data$`Altitude (m)`), sd = sd(tree_data$`Altitude (m)`)))
# 
# qqnorm(rnorm(n = length(tree_data$`Slope Cardinality`), mean =mean(tree_data$`Slope Cardinality`), sd = sd(tree_data$`Slope Cardinality`)))
# qqPlot(rnorm(n = length(tree_data$`Slope Cardinality`), mean =mean(tree_data$`Slope Cardinality`), sd = sd(tree_data$`Slope Cardinality`)))
# shapiro.test(rnorm(n = length(tree_data$`Slope Cardinality`), mean =mean(tree_data$`Slope Cardinality`), sd = sd(tree_data$`Slope Cardinality`)))
# 
# qqnorm(rnorm(n = length(tree_data$`Leaf-litter depth (cm)`), mean =mean(tree_data$`Leaf-litter depth (cm)`), sd = sd(tree_data$`Leaf-litter depth (cm)`)))
# qqPlot(rnorm(n = length(tree_data$`Leaf-litter depth (cm)`), mean =mean(tree_data$`Leaf-litter depth (cm)`), sd = sd(tree_data$`Leaf-litter depth (cm)`)))
# shapiro.test(rnorm(n = length(tree_data$`Leaf-litter depth (cm)`), mean =mean(tree_data$`Leaf-litter depth (cm)`), sd = sd(tree_data$`Leaf-litter depth (cm)`)))
# 
# qqnorm(rnorm(n = length(tree_data$Humidity), mean =mean(tree_data$Humidity), sd = sd(tree_data$Humidity)))
# qqPlot(rnorm(n = length(tree_data$Humidity), mean =mean(tree_data$Humidity), sd = sd(tree_data$Humidity)))
# shapiro.test(rnorm(n = length(tree_data$Humidity), mean =mean(tree_data$Humidity), sd = sd(tree_data$Humidity)))
# 
# qqnorm(rnorm(n = length(tree_data$`Crown Cover`), mean =mean(tree_data$`Crown Cover`), sd = sd(tree_data$`Crown Cover`)))
# qqPlot(rnorm(n = length(tree_data$`Crown Cover`), mean =mean(tree_data$`Crown Cover`), sd = sd(tree_data$`Crown Cover`)))
# shapiro.test(rnorm(n = length(tree_data$`Crown Cover`), mean =mean(tree_data$`Crown Cover`), sd = sd(tree_data$`Crown Cover`)))
# 
# qqnorm(rnorm(n = length(tree_data$`Total % Nitrogen`), mean =mean(tree_data$`Total % Nitrogen`), sd = sd(tree_data$`Total % Nitrogen`)))
# qqPlot(rnorm(n = length(tree_data$`Total % Nitrogen`), mean =mean(tree_data$`Total % Nitrogen`), sd = sd(tree_data$`Total % Nitrogen`)))
# shapiro.test(rnorm(n = length(tree_data$`Total % Nitrogen`), mean =mean(tree_data$`Total % Nitrogen`), sd = sd(tree_data$`Total % Nitrogen`)))
# 
# qqnorm(rnorm(n = length(tree_data$`Total % Carbon`), mean =mean(tree_data$`Total % Carbon`), sd = sd(tree_data$`Total % Carbon`)))
# qqPlot(rnorm(n = length(tree_data$`Total % Carbon`), mean =mean(tree_data$`Total % Carbon`), sd = sd(tree_data$`Total % Carbon`)))
# shapiro.test(rnorm(n = length(tree_data$`Total % Carbon`), mean =mean(tree_data$`Total % Carbon`), sd = sd(tree_data$`Total % Carbon`)))

```

## Correlations and Variance Inflation Factor in environmetal variables
 Using `datascl` data frame.The following analyses were performed using code from http://www.sthda.com/english/wiki/visualize-correlation-matrix-using-correlogram. 
```{r, Correlations between variables}
###Looking for correlations among variables###
corr.data <- cor(datascl[c(4:17)])

#Compute matrix of p-value
cor.mtest <- function(mat, ...) {
    mat <- as.matrix(mat)
    n <- ncol(mat)
    p.mat<- matrix(NA, n, n)
    diag(p.mat) <- 0
    for (i in 1:(n - 1)) {
        for (j in (i + 1):n) {
            tmp <- cor.test(mat[, i], mat[, j], ...)
            p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
        }
    }
  colnames(p.mat) <- rownames(p.mat) <- colnames(mat)
  p.mat
}

# matrix of the p-value of the correlation
p.mat <- cor.mtest(corr.data)

#Plotting correlation matrix
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(corr.data, method="color", col=col(200),  
         type="upper", order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt= 45, #Text label color and rotation
         # Combine with significance
         number.cex = 0.4,
         number.font = 1, 
         p.mat = p.mat, sig.level = 0.05, insig = "pch", 
         # hide correlation coefficient on the principal diagonal
         diag = T 
         )
```


# Paired t-tests of environmental factors/variables
Included in final manuscript 10/24/2022
```{r, paired t-tests}
#Raw data scaled - Included in Table 1 of manuscript 10/24/2022
t.test(Abundance ~ Treatment, data = datascl, paired = T)
t.test(Richness_per_replicate ~ Treatment, data = datascl, paired = T)
t.test(DBH ~ Treatment, data = datascl, paired = T)
t.test(Crown_Cover ~ Treatment, data = datascl, paired = T)
t.test(Coffee_plants ~ Treatment, data = datascl, paired = T)
t.test(Altitude ~ Treatment, data = datascl, paired = T)
#t.test(Precipitation ~ Treatment, data = datascl, paired = T)
t.test(Cardinality ~ Treatment, data = datascl, paired = T)
t.test(Dist_to_edge ~ Treatment, data = datascl, paired = T)
t.test(Litter_depth ~ Treatment, data = datascl, paired = T)
t.test(Quadrat_litter_depth ~ Treatment, data = datascl, paired = T)
t.test(pH ~ Treatment, data = datascl, paired = T)
t.test(Humidity ~ Treatment, data = datascl, paired = T)
t.test(CN ~ Treatment, data = datascl, paired = T)
t.test(`%_Nitrogen` ~ Treatment, data = datascl, paired = T)
t.test(`%_Carbon` ~ Treatment, data = datascl, paired = T)

#Summarized data unscaled
t.test(DBH ~ Treatment, data = tree_data, paired = T)
t.test(Crown_Cover ~ Treatment, data = tree_data, paired = T)
t.test(Coffee_plants ~ Treatment, data = tree_data, paired = T)
t.test(Altitude ~ Treatment, data = tree_data, paired = T)
t.test(Cardinality ~ Treatment, data = tree_data, paired = T)
t.test(Dist_to_edge ~ Treatment, data = tree_data, paired = T)
t.test(Litter_depth ~ Treatment, data = tree_data, paired = T)
t.test(pH ~ Treatment, data = tree_data, paired = T)
t.test(Humidity ~ Treatment, data = tree_data, paired = T)
t.test(CN ~ Treatment, data = tree_data, paired = T)
t.test(`%_Nitrogen` ~ Treatment, data = tree_data, paired = T)
t.test(`%_Carbon` ~ Treatment, data = tree_data, paired = T)

```

I guess here I have to weigh what is the most important for answering my question.
I could make a set of models using CNFraction and another using Leaflitter depth. 
I suspect CNfraction we'll be a better predictor facto for ant abundance and richness.
TAKE OUT
Precipitation
Plantas de cafe
Profundidad de winklers
Leaf litter depth

For analyses of all the tree data I would consider removing the most correlated variables: Coffee plants and miniwinkler dept vs leaf litter depth and CN fraction.
Proceed with the following: eliminate Precipitation, coffee plants, mini Winkler depth. 
The remaining are: Leaflitter depth, pH, CN fraction, Crown cover, Humidity, `Slope Cardinality`, Altitude, Distance to edge, and, finally, Sampling date and ID as random effects factors.
 
Shade, leaf litter depth, and the amount of coffee are all correlated. Because we think leaf litter is most important in explaining abundance of leaf litter ants we will remove BOTH shade cover and number of coffee plants see plots below for relationships between variables

# Abundance GLMM models 
SAMPLING DATE and ID as random effects factor
```{r, Model 1}
####Model 1
#Used function `scale()`
model_tree_data1 <- glmer(Abundance ~ Treatment +
                            DBH + 
                            Altitude + 
                            Cardinality + 
                            Dist_to_edge + 
                            Quadrat_litter_depth +
                            Litter_depth + 
                            Coffee_plants +
                            Crown_Cover +
                            pH +
                            Humidity + 
                            CN + 
                            `%_Nitrogen` + 
                            `%_Carbon` +
                            (1| Sampling_date) + 
                            (1| ID), data = datascl, family = "poisson",
                           control = glmerControl(optimizer="bobyqa"))

summary(model_tree_data1)

isSingular(model_tree_data1, tol = 1e-4)
AIC(model_tree_data1)

m1 <- Abundance ~ Treatment +
                            DBH + 
                            Altitude + 
                            Cardinality + 
                            Dist_to_edge + 
                            Quadrat_litter_depth +
                            Litter_depth + 
                            Coffee_plants +
                            Crown_Cover +
                            pH +
                            Humidity + 
                            CN + 
                            `%_Nitrogen` + 
                            `%_Carbon` +
                            (1| Sampling_date) + 
                            (1| ID)
m <- buildmer(m1, data=datascl, buildmerControl=list(direction='backward',
          args=list(control=lmerControl(optimizer='bobyqa'))))
# 
summary(m)
(f <- formula(m@model))

```

## Model validation
```{r, Visual model validation}
r.squaredGLMM(glmer(Abundance ~ 1 + Dist_to_edge + (1 | Sampling_date), data = datascl,family = "poisson",
                           control = glmerControl(optimizer="bobyqa")))
r.squaredGLMM(model_tree_data1)


M1_resid <- resid(model_tree_data1, type = "response")
M1_fitted <- fitted(model_tree_data1)
plot(M1_resid)
plot(M1_fitted)
op <- par(mfrow = c(2, 2), mar = c(4, 4, 2, 2))
plot(datascl$DBH, jitter(resid(model_tree_data1, type = "response")), xlab = "DBH", ylab = "Ordinary Residuals")
abline(h = 0, col = "blue")
plot(datascl$Altitude, jitter(resid(model_tree_data1, type = "response")), xlab = "Altitude ", ylab = "Ordinary Residuals")
abline(h = 0, col = "blue")
plot(datascl$`%_Nitrogen`, jitter(resid(model_tree_data1, type = "response")), xlab = "% Nitrogen", ylab = "Ordinary Residuals")
abline(h = 0, col = "blue")
plot(datascl$`%_Carbon`, jitter(resid(model_tree_data1, type = "response")), xlab = "% Carbon", ylab = "Ordinary Residuals")
abline(h = 0, col = "blue")

anova(model_tree_data1,type="marginal") #What is a type III ANOVA?
Anova(model_tree_data1, type = 3)
```

# Richness GLMM models 
SAMPLING DATE and ID as random effects factor

```{r, Model 1R}
####Model 1R
model_tree_data1R <- glmer(Richness_per_replicate ~ Treatment +
                            DBH + 
                            Altitude + 
                            Cardinality + 
                            Dist_to_edge + 
                            Quadrat_litter_depth +
                            Litter_depth + 
                            Coffee_plants +
                            Crown_Cover +
                            pH +
                            Humidity + 
                            CN + 
                            `%_Nitrogen` + 
                            `%_Carbon` +
                            (1| Sampling_date), data = datascl, family = "poisson",
                           control = glmerControl(optimizer="bobyqa"))

summary(model_tree_data1R) #AIC   179.6
isSingular(model_tree_data1R, tol = 1e-4)
AIC(model_tree_data1R)


m2 <- Richness_per_replicate ~ Treatment +
                            DBH + 
                            Altitude + 
                            Cardinality + 
                            Dist_to_edge + 
                            Quadrat_litter_depth +
                            Litter_depth + 
                            Coffee_plants +
                            Crown_Cover +
                            pH +
                            Humidity + 
                            CN + 
                            `%_Nitrogen` + 
                            `%_Carbon` +
                            (1| Sampling_date)
mm <- buildmer(m2, data=datascl, buildmerControl=list(direction='backward',
          args=list(control=lmerControl(optimizer='bobyqa'))))

summary(mm)

```


## Variance inflation factors

In both initial models the VIF for CN ratio and Percent Nitrogen was well above 5. In the initial model for ant richness `Treatment` was ~6.3.
```{r, VIFs}
# Ant Abundance Model
vif(model_tree_data1, type = "terms", data = datascl)

#create vector of VIF values
vif_valuesA <- vif(model_tree_data1, type = "terms", data = datascl)

#create horizontal bar chart to display each VIF value
barplot(vif_valuesA, main = "VIF Values", horiz = F, col = "steelblue")

#add vertical line at 5
abline(h = 5, lwd = 3, lty = 2)


#Ant Richness Model
vif(model_tree_data1R, type = "terms", data = datascl)

#create vector of VIF values
vif_valuesR <- vif(model_tree_data1R, type = "terms", data = datascl)

#create horizontal bar chart to display each VIF value
barplot(vif_valuesR, main = "VIF Values", horiz = F, col = "steelblue")

#add vertical line at 5
abline(h = 5, lwd = 3, lty = 2)

#Variance inflation factors range from 1 upwards. The numerical value for VIF tells you (in decimal form) what percentage the variance (i.e. the standard error squared) is inflated for each coefficient. For example, a VIF of 1.9 tells you that the variance of a particular coefficient is 90% bigger than what you would expect if there was no multicollinearity — if there was no correlation with other predictors.
#A rule of thumb for interpreting the variance inflation factor:

#1 = not correlated.
#Between 1 and 5 = moderately correlated.
#Greater than 5 = highly correlated.


```


## Model validation for richness models
Model selection and details
```{r}
r.squaredGLMM(glmer(Richness_per_replicate ~ Dist_to_edge + (1 | Sampling_date), data = datascl, control = lmerControl(optimizer = "bobyqa")))

r.squaredGLMM(model_tree_data1R)
####ANOVA table RICHNESS
plot(Abundance ~ Dist_to_edge, data =data)
anova(model_tree_data1R)

#############################################################################


##############################################################################
```


# Figure 3
# GLMMs tables and plots

### Estimate Plots
```{r}
#Initial GLLM Abundance
tree_color <- met.brewer("Derain", n = 2, type = "discrete")

set_theme(
  base = theme_bw(),
  axis.title.size = 1,
  axis.textsize = 1,
  legend.size = .7,
  legend.title.size = .8,
  geom.label.size = 3,
  geom.errorbar.linetype = 1
)
p <- plot_model(model_tree_data1,
           type = "std2", transform = NULL,
           title = "Initial GLMM: Ant Abundance",
           legend.title = "Fixed effects",
           vline.color = "grey50",
           show.values = TRUE,
           value.offset = .3, 
           value.size = 3,
           line.size = .5,
           width = 0.5,
           dot.size = 3,
           bpe = "median",
           bpe.style = "line",
           bpe.color = "black", 
           ci.style = "whisker", grid = TRUE
        ) +  scale_color_sjplot("dust")
p
#Initial GLMM Richness

r <- plot_model(model_tree_data1R,
           type = "std2", transform = NULL,
           title = "Initial GLMM: Ant Richness",
           legend.title = "Fixed effects",
           vline.color = "grey50",
           show.values = TRUE,
           value.offset = .3,
           value.size = 3,
           line.size = .5,
           width = 0.5,
           dot.size = 3,
           bpe = "median",
           bpe.style = "line",
           bpe.color = "black", 
           ci.style = "whisker", grid = TRUE
        ) +  scale_color_sjplot("dust")

r
#Plot grid
cowplot::plot_grid(p,r)

#ggsave2(filename="Figure_32GLMM_10282022.svg", plot = cowplot::plot_grid(p,r), dpi=600, units=c("mm"), width = 150, height = 180)

```

## Tables
```{r, GLMMs Tables}
#Tables
tab_model(model_tree_data1,m, model_tree_data1R, mm)

####
tab_model(model_tree_data1, model_tree_data1R,
          transform = NULL,
          show.est = TRUE,
          show.se = TRUE,
          auto.label = TRUE,
          # pred.labels = c("Intercept", "Tree Species", "DBH (cm)",
          #                 "Altitude (m.a.s.l.)", 
          #                 "Slope Cardinality",
          #                 "Distance to edge (m)", 
          #                 "1m2 leaf litter depth (mm)",
          #                 "Leaf litter depth (mm)", 
          #                 "Number of coffee plants",
          #                 "pH", 
          #                 "% soil humidity",
          #                 "C:N ratio", 
          #                 "% Nitrogen",
          #                 "% Carbon"),
          dv.labels = c("Initial GLMM: Ant Abundance ", " Initial GLMM: Ant Richness"),
          string.pred = "Coefficient",
          string.ci = "CI (95%)",
          string.p = "P-Value",
          digits.p = 3, 
          p.style = c("numeric_stars"),
file = "Table2_10282022.html")
```


# Figure 2 Local factors

```{r}
## CN RATIO per tree species
tree_color <- met.brewer("Derain", n = 2, type = "discrete")

###Plots CN ratios per tree species

CN <- ggplot(data, aes(Treatment,CN)) +
  geom_boxplot(aes(fill = Treatment), outlier.shape = NA) +
  geom_point(color="black", alpha = 0.2,size =2, position = position_jitter(w=0.05)) +
  theme_classic(base_size = 8) + 
  scale_fill_manual(values = tree_color, name = "") +
  theme(legend.position="", legend.title = element_blank(),
        legend.text = element_text(face = "italic")) +
  annotate("text", x = 2.5, y = 35, label = "c", size = 5) +
  labs(x="", y="C:N ratio") +
  theme(axis.text.x = element_text(face = "italic"))

CN

###Plot for total ph 
#pH was not significant with all the data points
# pH <- ggplot(data, aes(Treatment, pH)) +
#   geom_boxplot(aes(fill = Treatment), outlier.shape = NA) +
#   geom_point(color="black", alpha = 0.2,size =2, position = position_jitter(w=0.05)) +
#   theme_classic(base_size = 14) + 
#   scale_fill_manual(values = tree_color, name = "") +
#   theme(legend.position="", legend.title = element_blank()) +
#   annotate("text", x = 2.5, y = 7, label = "a", size = 10) +
#   labs(x="", y="pH") +
#   theme(axis.text.x = element_text(face = "italic"))
# pH

#DBH
DBH<- ggplot(data, aes(Treatment, DBH)) +
  geom_boxplot(aes(fill = Treatment), outlier.shape = NA) +
  geom_point(color="black", alpha = 0.2,size =2, position = position_jitter(w=0.05)) +
  theme_classic(base_size = 8) + 
  scale_fill_manual(values = tree_color, name = "") +
  theme(legend.position="", legend.title = element_blank()) +
  annotate("text", x = 2.5, y = 80, label = "a", size = 5) +
  labs(x="", y="DBH (cm)") +
  theme(axis.text.x = element_text(face = "italic"))
DBH

###Total % Nitrogen
Nitro <- ggplot(data, aes(Treatment, `%_Nitrogen`)) +
  geom_boxplot(aes(fill = Treatment), outlier.shape = NA) +
  geom_point(color="black", alpha = 0.2,size =2, position = position_jitter(w=0.05)) +
  theme_classic(base_size = 8) + 
  scale_fill_manual(values = tree_color, name = "") +
  theme(legend.position="", legend.title = element_blank()) +
  annotate("text", x = 2.5, y = 3.2, label = "b", size = 5) +
  labs(x="", y="Total % Nitrogen") +
  theme(axis.text.x = element_text(face = "italic"))

Nitro

###Coffe Plants
coffee <- ggplot(data, aes(Treatment, Coffee_plants)) +
  geom_boxplot(aes(fill = Treatment), outlier.shape = NA) +
  geom_point(color="black", alpha = 0.2,size =2, position = position_jitter(w=0.05)) +
  theme_classic(base_size = 8) + 
  scale_fill_manual(values = tree_color, name = "") +
  theme(legend.position="", legend.title = element_blank()) +
  annotate("text", x = 2.5, y = 55, label = "d", size = 5) +
  labs(x="", y="Number of coffee plants") +
  theme(axis.text.x = element_text(face = "italic"))

coffee
  
####Multipplot of CN, Carbon and Nitrogen 
multi <- grid.arrange(DBH, CN, Nitro, coffee, newpage = T)


#ggsave(filename="Figure_2LF_10242022.svg", plot = multi, dpi=600, units=c("mm"), width = 150, height = 150)
```



```{r}
#ABUNDANCE of ants per tree species

par(mfrow = c(1,2))

p1_AB <- ggplot(tree_data, aes(Treatment, Abundance)) +
  geom_boxplot(aes(fill = Treatment, size = "")) +
  theme_classic(base_size = 24) + 
  scale_fill_manual(values = tree_color, name = "") +
  theme(legend.position="", legend.title = element_blank())+
  labs(x="", y="Relative Abundance")
p1_AB

#RICHNESS per tree species

p2_RC <- ggplot(tree_data, aes(Treatment, Richness_total_abc)) +
  geom_boxplot(aes(fill = Treatment, size = "")) +
  theme_classic(base_size = 24) + 
  scale_fill_manual(values = tree_color, name = "") +
  theme(legend.position="", legend.title = element_blank()) +
  labs(x="", y="Richness")
p2_RC


####Multiplot


multiplot(p1_AB, p2_RC, cols = 2)

#ggsave(filename="Figure_LFA_11032022.svg", plot = multi2, dpi=600, units=c("mm"), width = 180, height = 120)
```


# Figure 3

```{r, Significant local factors Regression plots}
tree_color <- met.brewer("Derain", n = 2, type = "discrete")


#DBH

db <-ggplot(data = data, aes(x= DBH, y= Abundance, color = Treatment)) +
  geom_smooth(method = lm, se = F, size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 1, alpha = 0.7) +
 #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black", size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 2.2) +
 stat_regline_equation(label.y = 350 , label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black", size = 2.2) +
  labs(x="", y="Abundance", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend
db

#Nitrogen
nit <-ggplot(data = data, aes(x= `%_Nitrogen`, y= Abundance, color = Treatment)) +
  geom_smooth(method = lm, se = F, size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 1, alpha = 0.7) +
 #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black",  size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 2.2) +
 stat_regline_equation(label.y = 350 , label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black", size = 2.2) +
  labs(x="", y="", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend

nit

# Coffee Plants
#
cf <- ggplot(data = data, aes(x= Coffee_plants, y= Abundance, color = Treatment)) +
  geom_smooth(method = lm, se = F,  size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 1, alpha = 0.7) +
 #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black",  size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 2.2) +
 stat_regline_equation(label.y = 350 , label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black", size = 2.2) +
  labs(x="", y="", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend

cf

#CN ratio
cna <- ggplot(data = data, aes(x= CN, y= Abundance, color = Treatment)) +
  geom_smooth(method = lm, se = F, size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 1, alpha = 0.7) +
 #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black", size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 2.2) +
 stat_regline_equation(label.y = 350 , label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black", size = 2.2) +
  labs(x="", y="", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend

cna


###Richness

#DBH
db2 <-ggplot(data = data, aes(x= DBH, y= Richness_per_replicate, color = Treatment)) +
  geom_smooth(method = lm, se = F,  size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 1, alpha = 0.7) +
 #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black",  size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 2.2) +
 stat_regline_equation(label.y = 18, label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black", size = 2.2) +
  labs(x="DBH (cm)", y="Richness", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend
db2

#Nitrogen
nit2 <-ggplot(data = data, aes(x= `%_Nitrogen`, y= Richness_per_replicate, color = Treatment)) +
  geom_smooth(method = lm, se = F,  size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 1, alpha = 0.7) +
 #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black",  size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 2.2) +
 stat_regline_equation(label.y = 18 , label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black", size = 2.2) +
  labs(x="Total % Nitrogen", y="", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend

nit2

# Coffee Plants
#
cf2 <- ggplot(data = data, aes(x= Coffee_plants, y= Richness_per_replicate, color = Treatment)) +
  geom_smooth(method = lm, se = F,  size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 1, alpha = 0.7) +
 #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black",  size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 2.2) +
 stat_regline_equation(label.y = 18 , label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black", size = 2.2) +
  labs(x="Number of coffee plants", y="", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend

cf2

#CN ratio
cna2 <- ggplot(data = data, aes(x= CN, y= Richness_per_replicate, color = Treatment)) +
  geom_smooth(method = lm, se = F,  size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 1, alpha = 0.7) +
 #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black",  size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 2.2) +
 stat_regline_equation(label.y = 18 , label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black", size = 2.2) +
  labs(x="C:N ratio", y="", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend

cna2
#####Multipplot of CN, Carbon and Nitrogen 
multi2 <- grid.arrange(db, cna, nit, cf, db2, cna2, nit2, cf2,nrow = 2, ncol = 4, newpage = T)

```


# Figure 5: GLMMs Prediction
```{r, Distance to edge model predictions}
tree_color <- met.brewer("Derain", n = 2, type = "discrete")

####Model predictions from GLMMs
# Predicted count of Abundance
plot_model(model_tree_data1, type = "pred", terms = "Dist_to_edge")
bb <- ggpredict(model_tree_data1, type = "fe", terms = "Dist_to_edge", ci.lvl = 0.95)
bb
plot(bb)

prma <- ggplot(bb, aes(x = x, y = predicted)) +
  stat_smooth(method = "lm", se = T, fullrange = TRUE, color = "black") + 
  geom_jitter(data= datascl, aes(x = Dist_to_edge, y = Abundance, color = Treatment, shape = Treatment),size = 2, alpha = 0.7) +
   stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 3) +
 stat_regline_equation(label.y = 350, label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black",size = 3) +
  labs(x="Distance to edge (m)", y="Abundance", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) +
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") 
prma

#Predicted counts of Richness
rr <- ggpredict(model_tree_data1R, type = "re", terms = "Dist_to_edge", ci.lvl = 0.95)
rr
plot(rr)

prr <- ggplot(rr, aes(x = x, y = predicted)) +
  stat_smooth(method = "lm", se = T, fullrange = TRUE, color = "black") + 
  geom_jitter(data= datascl, aes(x = Dist_to_edge, y = Richness_per_replicate, color = Treatment, shape = Treatment),size = 2, alpha = 0.7) +
   stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 3) +
 stat_regline_equation(label.y = 19, label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black",size = 3) +
  labs(x="Distance to edge (m)", y="Richness", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) +
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") 
prr


prdte <- grid.arrange(prma, prr, nrow = 1, ncol = 2, newpage = T)

#ggsave(filename="Figure_PredDTE_11032022.svg", plot = prdte, dpi=600, units=c("mm"), width = 180, height = 100)
```


## Figure 5: Simple linear 
```{r, Simple linear regression plots}
#Distance to edge 
 dte <-ggplot(data = data, aes(x= Dist_to_edge, y= Abundance, color = Treatment)) +
   geom_smooth(method = lm, se = F, size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 2, alpha = 0.7) +
 stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black", size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 3) +
 stat_regline_equation(label.y = 350, label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black",size = 3) +
  labs(x="Distance to edge (m)", y="Abundance", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend

dte


# Richness
#Distance to edge 
dte2 <-ggplot(data = data, aes(x= Dist_to_edge, y= Richness_per_replicate, color = Treatment)) +
  geom_smooth(method = lm, se = F,  size = 0.5) +
geom_jitter(aes(color = Treatment, shape = Treatment),size = 2, alpha = 0.7) +
 #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  #stat_regline_equation(aes(label = paste(..eq.label.., ..adj.rr.label.., sep = "~~~~"))) +
  geom_smooth(method = lm, se = T , level = 0.95, na.rm = F, color = "black",  size = 0.5) +
  stat_regline_equation(label.y.npc = "top", label.x.npc = "center", aes(label = ..eq.label..), color= "black", size = 3) +
 stat_regline_equation(label.y = 19.5, label.x.npc = "center", aes(label = ..adj.rr.label..), color = "black",size = 3) +
  labs(x="Distance to edge (m)", y="Richness", col = "Treatment") +
  theme_bw(base_size = 10) +
  theme(legend.position="right", legend.title = element_blank(),
        legend.text = element_text(size = 8, face = "italic"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_fill_manual(values = tree_color) + # color for points
  scale_color_manual(values = tree_color) + # color for lines
  guides(color = "none")  +      #To turn off color legend
  guides(fill = "none") + #To turn off fill legend
  guides(shape = "none") #To turn off shape legend

dte2


dte22 <- grid.arrange(dte, dte2, nrow = 1, ncol = 2, newpage = T)
#ggsave(filename="Figure_LFA_11032022.svg", plot = multi2, dpi=600, units=c("mm"), width = 180, height = 120)

#ggsave(filename="Figure_DTE_11032022.svg", plot = dte22, dpi=600, units=c("mm"), width = 180, height = 100)
```

# Simple LMs
p-values from these LMs were used for figures in final manuscript. Values were added using Inkscape.
```{r}
#Distance to edge
#Both
bdt <- lm(Abundance ~ Dist_to_edge, data = datascl)
summary(bdt)
bdtr <- lm(Richness_per_replicate ~ Dist_to_edge, data = datascl)
summary(bdtr)

#Abundance
dta <- nlme::lmList(Abundance ~ Dist_to_edge | Treatment, data = data)
summary(dta)

#Richness
dtr <- nlme::lmList(Richness_per_replicate ~ Dist_to_edge | Treatment, data = data)
summary(dtr)


###DBH
bdbh <- lm(Abundance ~ DBH, data = data)
summary(bdbh)
rdbh <- lm(Richness_per_replicate ~ DBH, data = data )
summary(rdbh)

#Abundance
dbhh <- nlme::lmList(Abundance ~ DBH | Treatment, data = data)
summary(dbhh)

#Richness
dbhr <- nlme::lmList(Richness_per_replicate ~ DBH | Treatment, data = data)
summary(dbhr)

#CN
#both
cnn <- lm(Abundance ~ CN, data = data)
summary(cnn)
cnnr <- lm(Richness_per_replicate ~ CN, data = data)
summary(cnnr)

#Abundance
cnna<- nlme::lmList(Abundance ~ CN | Treatment, data = data)
summary(cnna)

#Richness
cnnrr <- nlme::lmList(Richness_per_replicate ~ CN | Treatment, data = data)
summary(cnnrr)

#Total Nitrogen
#Both
na <- lm(Abundance ~ `%_Nitrogen`, data = data)
summary(na)
narr <- lm(Richness_per_replicate ~ `%_Nitrogen`, data = data)
summary(narr)

#Abundance
nnaa <- nlme::lmList(Abundance ~ `%_Nitrogen` | Treatment, data = data)
summary(nnaa)

#Richness
nnrr <- nlme::lmList(Richness_per_replicate ~ `%_Nitrogen` | Treatment, data = data)
summary(nnrr)

#Both
cp <- lm(Abundance ~ Coffee_plants, data = data)
summary(cp)
cpr <- lm(Richness_per_replicate ~ Coffee_plants, data = data)
summary(cpr)

#Abundance
cpa <- nlme::lmList(Abundance ~ Coffee_plants | Treatment, data = data)
summary(cpa)

#Richness
cprr <- nlme::lmList(Richness_per_replicate ~ Coffee_plants | Treatment, data = data)
summary(cprr)

```

#PCA darkeness
Principal Component Analysis using tree_data and GlMEr output to determine axis to be used.
```{r,}
###PCA using covariates to explain species richness/abundance
tree_data.pca <- tree_data[,c(4:7, 10:12, 15:17)]
###Names for PCA plots
names(tree_data)
new_name33 <- c("Sampling date", "DBH", "Altitude", "Cardinality", "Dist. to edge", "Coffee plants")
colnames(tree_data)[3:8] <- new_name33
new_name_44 <- c("Litter depth","pH","Humidity","Crown Cover", "Precipitation (mm)", "% Nitrogen", "% Carbon", "C:N")
colnames(tree_data)[10:17] <- new_name_44

###Run this to create pca with prcomp function
# pca<-prcomp(tree_data.pca, center = TRUE, scale = T)
# pca
# summary(pca)
# pca$rotation=-pca$rotation
# pca$x=-pca$x
# plot(pca,type="lines")
# biplot(pca)
####################################################################################
### With princomp function
pca<- princomp(tree_data.pca, cor = TRUE)
biplot(pca)
PCi<-data.frame(pca$scores,Treatment = tree_data$Treatment)
PCi
#####################################################################################
###PCA using Lauren's code (ggfortify) and modifying with ggplot nomenclature

pretty.pca <- autoplot(pca, data = tree_data, colour = "Treatment", shape = "Treatment", alpha=0.65,
                       frame=T, frame.type = 'norm', fram.size = 2, loadings=T,loadings.colour="black",
                       loadings.label=T,loadings.label.colour="black",loadings.label.size = 6, size = 10, 
                       repel=T) + 
  geom_hline(yintercept = 0, colour = "black", size = .8) +
  geom_vline(xintercept = 0, colour = "black", size = .8) +
  scale_color_manual(values = tree_color) +
  theme_bw(base_size = 26) +
  theme(legend.position = "right", legend.title = element_blank(),
        legend.text = element_text(face = "italic")) 

pretty.pca 


percentagePC1 <- round((((pca$sdev)^2 / sum(pca$sdev^2))*100)[1])
percentagePC2 <- round((((pca$sdev)^2 / sum(pca$sdev^2))*100)[2])
percentagePC1 <- paste( colnames(pca), "PC1 (", paste( as.character(percentagePC1), "%", ")", sep = ""))
percentagePC2 <- paste( colnames(pca), "PC2 (", paste( as.character(percentagePC2), "%", ")", sep = ""))
p <-  pretty.pca + xlab(percentagePC1) + ylab(percentagePC2) 
p

#####################################################################################
```

## Principal Component Regressions

### ABUNDANCE and PC axes

```{r, PC1 and abundance}
AB_PC1_line<-lm(tree_data$Abundance ~ PCi$Comp.1)
AB_PC1_line
summary(AB_PC1_line)
AB_PC1 <- ggplot(PCi, aes(Comp.1, tree_data$Abundance)) + 
  geom_point(aes(color = Treatment, shape = Treatment), size = 12, alpha = 0.65) +
  scale_color_manual( values = tree_color) +
  theme_classic(base_size = 46) +
  theme(legend.position="", legend.title = element_blank()) +
  labs(x = "PC1", y = "Abundance") +
  geom_abline(intercept = AB_PC1_line$coefficients[[1]], slope = AB_PC1_line$coefficients[[2]], size = 1, color = "black") +
  annotate("text", x = 1.5, y = 650, label = "y = 252.85 - 7.12x, 
           R^2: 0.005, p-value: 0.71", size = 16)
AB_PC1

###PC2 and abundance
AB_PC2_line<-lm(tree_data$Abundance ~ PCi$Comp.2)
AB_PC2_line
summary(AB_PC2_line)
AB_PC2 <- ggplot(PCi, aes(Comp.2, tree_data$Abundance)) + 
  geom_point(aes(color = Treatment, shape = Treatment), size = 12, alpha = 0.65) +
  scale_color_manual( values = tree_color ) +
  theme_classic(base_size = 46) +
  theme(legend.position="", legend.title = element_blank()) +
  labs(x = "PC2", y = "Abundance") +
  geom_abline(intercept = AB_PC2_line$coefficients[[1]], slope = AB_PC2_line$coefficients[[2]], size = 1, color = "black") +
  annotate("text", x = 1.5, y = 650, label = "y = 252.85 - 6.05x, 
           R^2: 0.003, p-value: 0.79", size =16)
AB_PC2

###RICHNESS and PC axes
###PC1 and richness
RI_PC1_line<-lm(tree_data$Richness_total_abc ~ PCi$Comp.1)
RI_PC1_line
summary(RI_PC1_line)
RI_PC1 <- ggplot(PCi, aes(Comp.1, tree_data$Richness_total_abc)) + 
  geom_point(aes(color = Treatment, shape = Treatment), size = 12, alpha = 0.65) +
  scale_color_manual( values = tree_color ) +
  theme_classic(base_size = 46) +
  theme(legend.position="", legend.title = element_blank()) +
  labs(x = "PC1", y = "Richness") +
  geom_abline(intercept = RI_PC1_line$coefficients[[1]], slope = RI_PC1_line$coefficients[[2]], size = 1, color = "black") +
  annotate("text", x = 1.5, y = 45, label = "y = 20.77 + 0.17x, 
           R^2: 0.001, p-value: 0.87", size = 16)

RI_PC1

###PC2 and abundance
RI_PC2_line<-lm(tree_data$Richness_total_abc ~ PCi$Comp.2)
RI_PC2_line
summary(RI_PC2_line)
RI_PC2 <- ggplot(PCi, aes(Comp.2, tree_data$Richness_total_abc)) + 
  geom_point(aes(color = Treatment, shape = Treatment), size = 12, alpha = 0.65) +
  scale_color_manual( values = tree_color ) +
  theme_classic(base_size = 46) +
  theme(legend.position="", legend.title = element_blank()) +
  labs(x = "PC2", y = "Richness") +
  geom_abline(intercept = RI_PC2_line$coefficients[[1]], slope = RI_PC2_line$coefficients[[2]], size = 1, color = "black") +
  annotate("text", x = 1.5, y = 45, label = "y = 20.77 - 0.34x, 
           R^2: 0.003, p-value: 0.77", size = 16)

RI_PC2
#######################################################################
#Multiplot of PCs regressions

multiplot(AB_PC1, AB_PC2, RI_PC1, RI_PC2, cols = 2)
#######################################################################
```

# Diversity and community composition
## SACs - Species Accumulation curves

Dissimilarity matrix
```{r}
par(mfrow = c(1,1))
dissim <- datascl[c(21:89)]
#t(dissim)
#tdissim <- as.data.frame(t(dissim))
#tdissim <- tdissim %>%
#  rownames_to_column(var = "species")
#colnames(tdissim) <- c("species", tdissim$species)
dissim <- as.data.frame(dissim)
```
# Figure 1 SAC
```{r, SAC "exact" method}
tree_color <- met.brewer("Derain", n = 2, type = "discrete")
Accum.1 <- accumcomp(dissim, y=data, factor='Treatment', 
    method='exact', gamma = "jack2",  permutations=100,
   conditioned = T, plotit= F)
Accum.1

#Long format
accum.long1 <- accumcomp.long(Accum.1, ci= NA, label.freq = 5)


#ggplot
BioR.theme <- theme(
        panel.background = element_blank(),
        panel.border = element_rect(linetype = "solid", fill = NA,),
        panel.grid = element_blank(),
        axis.line = element_line("black"),
        text = element_text(size = 14),
        axis.text = element_text(size = 12, colour = "black"),
        axis.title = element_text(size = 14, colour = "black"),
        legend.title = element_blank(),
        legend.position= c(.8,.3),
        legend.text = element_text(size = 14, face = "italic"),
        legend.key = element_blank())

plotgg1 <- ggplot(data = accum.long1, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(expand=c(0, 1), sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour =Grouping), size= 1.5) +
    geom_point(data = subset(accum.long1, labelit == TRUE), 
               aes(colour = Grouping, shape = Grouping), size = 2.5) +
    geom_ribbon(aes(colour = Grouping, fill= after_scale(alpha(colour, 0.3))), show.legend=FALSE) + 
    scale_y_continuous(limits = c(0,70)) +
  theme_classic() +
  BioR.theme +
  scale_color_manual(values = tree_color)+
    labs(x = "Number of Sampling Quadrats", y = "Number of Species", colour = "Treatment", shape = "Treatment")

plotgg1

#ggsave(filename="Figure_1SAC_10252022.svg", plot = plotgg1, dpi=600, units=c("mm"), width = 180, height = 200)

##I need to decide which method of rearefaction is better. 
##############################################################################
```

## Species of interest

```{r, Paired t-tests for species on interest}
#Nylanderia
#
t.test(Nylanderiasp1 ~ Treatment, data =datascl, paired = T)

#Pheidole protensa
t.test(datascl$Pheidolesp4protensa ~ Treatment, data =datascl, paired = T)


# For loop with aov()
for (i in 21:ncol(datascl)) {
   formula <- as.formula(paste(colnames(datascl)[i], " ~ Treatment", sep=""))
   model <- aov(formula, data = datascl)

   cat("\n-----\n\n")
   cat(colnames(datascl)[i])
   cat("\n")
   print(summary(model))
}



```

## Bray Curtis dissimilarity index
### ANOSIM
```{r, Do we need to transform?}
range(dissim)
range(dissim*0.5)
range(dissim*0.25)
```


```{r, ANOSIM}
ant_dist <- vegdist(dissim, method="bray", binary=FALSE) #Bray-Curtis dissimilarity matrix
# ant.ano <- anosim(ant_dist, datascl$Treatment, 
#                   permutations = 10000,
#                   distance = "bray", 
#                   strata = NULL)
# summary(ant.ano)
```

With or without fourth root transformation, the results from `vegdist` and subsequent analyses remain the same. I am not transforming the data for later analyses. -10/30/2022

### Shannon's index
```{r, Shannon index}
# ing_dissim <- ing_data[c(19:87)]
# dim(ing_dissim)
# shannon<-diversity(ing_dissim, index="shannon")
# shannon
# summary(shannon)
# 
# al_dissim <- al_data[c(19:87)]
# dim(al_dissim)
# al_shannon<-diversity(al_dissim, index="shannon")
# al_shannon
# summary(al_shannon)
```

### NMDS 
Ordination - using bray-curtis
```{r, NMDS}
# x<-as.matrix(dissim)
# NMDS <- metaMDS(x,distance = "bray", display = c("sites", "species"),k = 4,trymax = 1000)
# stressplot(NMDS)
# NMDS$stress
```


### NMDS Aesthetics
### ggplots
```{r, Nice plots }
# data.scores <- as_tibble(scores(NMDS)$sites)  
# #Using the scores function from vegan to extract the site scores and convert to 
# head(data.scores)
# 
# NM.DS <- ggplot(data.scores,aes(NMDS1, NMDS2, color = datascl$Treatment)) +
#   geom_point(aes(color = datascl$Treatment, shape = datascl$Treatment), size = 10, alpha = 0.85) +
#   geom_hline(yintercept = 0, colour = "black", size = 0.8) +
#   geom_vline(xintercept = 0, colour = "black", size = 0.8) + 
#   scale_color_manual(values = tree_color) +
#   theme_bw(base_size = 16) +
#   theme(legend.position="right", legend.title = element_blank(), 
#         legend.text = element_text(face = "italic")) +
#   stat_ellipse(mapping = NULL, data = data.scores, geom = "path", size = 1.75,
#                position = "identity", type = "t", linetype = 1, level = 0.95, segments = 51,
#                na.rm = FALSE, show.legend = NA, inherit.aes = TRUE) +
#   annotate("text", x=-0.6, y=-0.9, label=paste('Stress =',round(NMDS$stress,3)))
# 
# NM.DS

#ggsave(filename="Figure_3NMDS_10252022.png", plot = NM.DS, dpi=600, units=c("mm"), width = 300, height = 300)

```

# Table 3
## PERMANOVA using `adonis2`
An explanation of why we use dbRDA with oout type of data from Perter Tellez's 2022 paper: *"We used distance-based redundancy analyses (dbRDA) to visualize associations between leaf functional traits and endophyte communities. We excluded OTUs represented by a single sequence (singletons) and calculated a Bray-Curtis dissimilarity matrix based on endophyte relative abundance data".*
*We tested for differences in endophyte community composition as a function of host species and genus, using a permutational multivariate analysis of variance (PERMANOVA, 999 permutations, (69)). We used a permutational analysis of multivariate dispersion (PERMDISP; (69)) to test for homogeneity of variance in endophyte communities. We used a PERMDISP as a companion to PERMANOVA to exclude the possibility that any significant differences were caused by differences in the variance of endophyte communities. The relative explanatory power of host species and leaf functional traits on endophyte communities was compared using a partial-dbRDA.*

### Analysis of multivariate homogeneity of group dispersions. 

```{r, PERMDISP}
set.seed(123)
beta <- betadisper(ant_dist, datascl$Treatment, type = "centroid", sqrt.dist = FALSE)

beta
anova(beta)
permutest(beta, permutations = 9999)

plot(beta, hull=FALSE, ellipse=TRUE)
TukeyHSD(beta)
boxplot(beta, xlab = "", las = 2, cex.axis = 0.8)
```
Who contributes more to differneces in the community composition?

```{r, SIMPER}
(sim <- with(datascl, simper(dissim, Treatment, permutations = 9999)))
summary(sim)
```




### PERMANOVA
```{r, adonis2}
perma <- adonis2(dissim ~ Treatment +
                            DBH + 
                            Altitude + 
                            Cardinality + 
                            Dist_to_edge + 
                            Quadrat_litter_depth +
                            Litter_depth + 
                            Coffee_plants +
                            Crown_Cover +
                            pH +
                            Humidity + 
                            CN + 
                            `%_Nitrogen` + 
                            `%_Carbon` ,
                 data = datascl,
permutation = 9999, method = "bray", 
strata = NULL)
print(perma)
dfperma <- as.data.frame(perma)
#fwrite(dfperma,"C:\\Users\\boloq\\Box\\Thesis\\Proyecto 2\\Data\\dfperma.csv" )


# perma2 <- adonis2(dissim ~ Treatment,data = datascl,
# permutation = 9999, method = "bray", 
# strata = NULL)
```

# Figure 6
## dbRDA
```{r, dbRDA}
m3dbRDA <- capscale(ant_dist ~
                            DBH + 
                            Altitude + 
                            Cardinality + 
                            Dist_to_edge + 
                            Quadrat_litter_depth +
                            Litter_depth + 
                            Coffee_plants +
                            Crown_Cover +
                            pH +
                            Humidity + 
                            CN + 
                            `%_Nitrogen` + 
                            `%_Carbon` , data = datascl, na.action = na.omit)
anova(m3dbRDA, by = "margin")
print(m3dbRDA)
m3dbRDA$adjust
#plot using ggplot2
names(m3dbRDA)
B <- summary(m3dbRDA)

A.1 <- vegan::scores(m3dbRDA)
A.2 <- A.1$sites
A.3 <- cbind(A.2, datascl)

#scores for arrows
A.4 <- data.frame(vegan::scores(m3dbRDA, display = "bp"))
A.4

# Define the arrow aesthetic mapping
arrow_map <- aes(xend = (CAP1*2), yend = (CAP2*2), x = 0, y = 0, shape = NULL, color = NULL, fill = NULL)
label_map <- aes(x = 2*CAP1, y = 2*CAP2, label = row.names(A.4), shape = NULL, color = NULL, fill = NULL)
arrowhead = arrow(length = unit(0.02, "npc"))

#subset A4 for labeling
A.44 <- A.4[sort(rownames(A.4)),]
A.44
A4.sub1 <- A.44[1,] #Carbon
A4.sub2 <- A.44[2,] #Nitrogen
A4.sub3 <- A.44[3,] #Altitude
A4.sub4 <- A.44[4,] #Cardinality
A4.sub5 <- A.44[5,] #CN
A4.sub6 <- A.44[6,] #Coffee plants 
A4.sub7 <- A.44[7,]  #Crown Cover
A4.sub8 <- A.44[8,]  #DBH#  
A4.sub9 <- A.44[9,]  #Dist to edge 
A4.sub10 <- A.44[10,]  #Humidity 
A4.sub11 <- A.44[11,]  #Litter depth 
A4.sub12 <- A.44[12,] #ph 
A4.sub13 <- A.44[13,] #Quadrat litter



A.4
#A4.sub4

# Make plot
p_m3 <- ggplot(data = A.3, aes(x = CAP1, y = CAP2))
p_m3
p_m3dbrda <- p_m3 +
  geom_point(data = A.3, aes(color = Treatment, shape = Treatment), size = rel(3), alpha = 0.8, stroke = 1) +
  geom_segment(arrow_map, size = rel(.6), data = A.4, color = "black", arrow = arrowhead) +
  geom_vline(xintercept = 0, color = "grey30", linetype = "dashed") + # plot vertical line
  geom_hline(yintercept = 0, color = "grey30", linetype = "dashed") + # plot horizontal line
  geom_text(label_map, size = rel(4), data = A4.sub1, fontface = "bold", show.legend = FALSE, hjust = 1, label = c("% Carbon"), nudge_y = -0.15) +
  geom_text(label_map, size = rel(4), data = A4.sub2, fontface = "bold", show.legend = FALSE, hjust = -0.1, label = c("% Nitrogen"), nudge_y = 0.2) +
  geom_text(label_map, size = rel(4), data = A4.sub3, fontface = "bold", show.legend = FALSE, hjust = 0.8, label = c("Altitude"), nudge_y = -0.2) +
  geom_text(label_map, size = rel(4), data = A4.sub4, fontface = "bold", show.legend = FALSE, hjust = 0.9, label = c("Cardinality"), nudge_y = -0.17) +
  
  geom_text(label_map, size = rel(4), data = A4.sub5, fontface = "bold", show.legend = FALSE, hjust = 1, label = c("C:N ratio"), nudge_y = -0.15) +
  geom_text(label_map, size = rel(4), data = A4.sub6, fontface = "bold", show.legend = FALSE, hjust = -0.1, label = c("Coffe plants"), nudge_y = 0.2) +
  geom_text(label_map, size = rel(4), data = A4.sub7, fontface = "bold", show.legend = FALSE, hjust = 0.8, label = c("% crown cover"), nudge_y = -0.2) +
  geom_text(label_map, size = rel(4), data = A4.sub8, fontface = "bold", show.legend = FALSE, hjust = 0.9, label = c("DBH"), nudge_y = -0.17) +
  
   geom_text(label_map, size = rel(4), data = A4.sub9, fontface = "bold", show.legend = FALSE, hjust = 1, label = c("Dist. to edge"), nudge_y = -0.15) +
  geom_text(label_map, size = rel(4), data = A4.sub10, fontface = "bold", show.legend = FALSE, hjust = -0.1, label = c("% soil humidity"), nudge_y = 0.2) +
  geom_text(label_map, size = rel(4), data = A4.sub11, fontface = "bold", show.legend = FALSE, hjust = 0.8, label = c("Litter depth"), nudge_y = -0.2) +
  geom_text(label_map, size = rel(4), data = A4.sub12, fontface = "bold", show.legend = FALSE, hjust = 0.9, label = c("pH"), nudge_y = -0.17) +
  
   geom_text(label_map, size = rel(4), data = A4.sub13, fontface = "bold", show.legend = FALSE, hjust = 0.9, label = c("1m^2 litter depth"), nudge_y = -0.17) +
  
  
  xlab(label = paste("CAP1 (", round(B$concont$importance[2,1]*100, digits = 1), "%)", sep="")) +
  ylab(label = paste("CAP2 (", round(B$concont$importance[2,2]*100, digits = 1), "%)", sep="")) +
  scale_color_manual(values = tree_color) +
  stat_ellipse(aes(color=Treatment), geom = "path", size = 1.3, position = "identity", type = "t", linetype = 1,
               level = 0.95, segments = 51, na.rm = FALSE, show.legend = NA, inherit.aes = TRUE) +
  theme(legend.position="right", legend.title = element_blank(), 
        legend.text = element_text(face = "italic")) +
  labs(caption = "VVV") +
     theme_bw(base_size = 16)

p_m3dbrda

# Rearranging the order of layers so arrows are above the points.
p_m3dbrda$layers
p_m3dbrda$layers <- c(p_m3dbrda$layers,
                      p_m3dbrda$layers[[5]], 
                      p_m3dbrda$layers[[6]],
                      p_m3dbrda$layers[[7]], 
                      p_m3dbrda$layers[[8]], 
                      p_m3dbrda$layers[[9]],
                      p_m3dbrda$layers[[10]],
                      p_m3dbrda$layers[[11]],
                      p_m3dbrda$layers[[12]], 
                      p_m3dbrda$layers[[13]],
                      p_m3dbrda$layers[[14]], 
                      p_m3dbrda$layers[[15]], 
                      p_m3dbrda$layers[[16]],
                      p_m3dbrda$layers[[17]],
                      p_m3dbrda$layers[[18]]) 
                      
p_m3dbrda

#ggsave(filename="Figure_dbRDA_10292022.svg", plot = p_m3dbrda, dpi=600, units=c("mm"), width = 300, height = 300)
```

# Citations
Citation of packages used for statistical analyses. For reference go [here]https://bookdown.org/yihui/rmarkdown-cookbook/write-bib.html
```{r, Cite using kitr}
packages <- toBibtex(citation("base"))
packages
knitr::write_bib(c(.packages(),"car", 
                   "vegan",
                   "MuMIn",
                   "BiodiversityR", 
                   "buildmer", 
                   "lme4"), file = "packages.bib")

```

